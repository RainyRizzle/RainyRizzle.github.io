<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <!-- 제목 -->
        <title>アニメーションイベントとスクリプト</title>
        <!-- 파비콘 -->
        <link rel="shortcut icon" href="../../Images/favicon.ico"/>
        <!-- 부트스트랩 -->
        <link rel="stylesheet" href="../../css/bootstrap.css">
        <!--------------->

    </head>

    <body>
        <p>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <!--로고 : AnyPortrait 홈페이지로 가야한다. (언어별)-->
            <a class="navbar-brand" href="https://www.rainyrizzle.com/anyportrait-jp">
                <img src="../../Images/AP_Logo.png" width="150" height="30" class="d-inline-block align-top" alt="">
            </a>

            <!--메뉴들 : 현재 페이지의 카테고리에 active 붙인다. (언어별 링크) -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="../../jp/GettingStarted.html">入門ガイド</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="../../jp/AdManual.html">マニュアル</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../jp/Script.html">スクリプト</a>
                </li>

                </ul>

                <!-- 언어 변경. 현재 페이지의 주소에서 언어 주소만 변경한다. (해당 언어에 active) -->
                <div class="btn-group mr-2" role="group" aria-label="Basic example">
                    <a role="button" class="btn btn-secondary" href="../../en/AdvancedManual/AD_AnimationEvents.html">EN</a>
                    <a role="button" class="btn btn-secondary" href="../../kr/AdvancedManual/AD_AnimationEvents.html">KR</a>
                    <a role="button" class="btn btn-secondary active" href="../../jp/AdvancedManual/AD_AnimationEvents.html">JP</a>
                </div>

                <!-- 여백 -->
                <p></p>

                <!-- 검색버튼 -->
                <form class="form-inline">
                    <a class="btn btn-light" role="button" href="../../jp/Search.html">サーチ</a>
                </form>
            </div>
        </nav>
    </p>

    <!-- 실제 바디 부분 -->
    <div class="container">
    <br>
    <br>
    <!-- 여기에 내용을 적어주세요 -->

    <!-- 여기서부터 페이지 내용이 작성됩니다. -->
    <!-- 1. 페이지 진입 경로 -->
    <p><a href="https://www.rainyrizzle.com/anyportrait-jp"><span class="text-dark">AnyPortrait</span></a> > <a href="../../jp/AdManual.html"><span class="text-dark">マニュアル</span></a> > アニメーションイベントとスクリプト</p>
    
    <!-- 2. 페이지 메인 타이틀 -->
    <h1 class="display-5">アニメーションイベントとスクリプト</h1>
    <br>
    
    <!-- 4. 버전 설명 -->
    <h4><span class="badge badge-secondary">1.3.4</span></h4>
    
    <p>
    ゲームに応じて、アニメーションのある時点で、キャラクターは何らかの相互作用を必要とします。<br>
    走るキャラクターがジャンプをしたときに土ぼこりが発生したり、キャラクターが振るう剣がモンスターを殴ることもできます。<br>
    このページでは、「<strong>アニメーションイベント (Animation Event)</strong>」関数を使用して、スクリプトと対話する方法を学習します。<br>
    (C＃スクリプトを含む。)<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_122.jpg"/>
    <br>
    
    <p>
    アニメーションのプロパティUIで、「<strong>Animation Events」</strong>ボタンをクリックして、アニメーションイベントを登録するダイアログを開きます。<br>
    </p>
    <br>
    
    <br>
    <br>
    <!-- 3. 서브 타이틀 -->
    <h3>アニメーションイベントを追加し、それらをスクリプトに関連付け</h3>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_123.jpg"/>
    <br>
    
    <p>
    <strong>(1)</strong> <strong>「Add Event」ボタン</strong>をクリックして新しいイベントを追加します。<br>
    <strong>(2)</strong> <strong>イベント名を設定し</strong>、呼び出すフレームを入力します。<br>
    イベントの名前はスクリプトとリンクされているので、その時の名前を覚えておいてください。<br>
    私はここで 「<span class="text-danger"><strong>SampleAnimEvent</strong></span>」として作成しました。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_124.jpg"/>
    <br>
    
    <p>
    アニメーションイベントが追加されると、タイムラインGUIに「<strong>イベントマーカー (Event Marker)</strong>」が追加されたことがわかります。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_125.jpg"/>
    <br>
    
    <p>
    「Bake」とシーンを開きます。<br>
    イベントに関連付けるスクリプトを作成します。<br>
    <strong>(1)</strong> スクリプトを格納する「<strong>GameObject</strong>」を作成します。 (それは新しいものである必要はなく、スクリプトを含む 「GameObject」のどれかでもかまいません。)<br>
    <strong>(2)</strong> <strong>「MonoBehaviour」</strong>スクリプトを作成して追加します。<br>
    </p>
    <br>
    
    <p>
    次のコードを記述します：<br>
    上で作成したアニメーションイベントの名前は「<span class="text-danger"><strong>SampleAnimEvent</strong></span>」です。<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    <span class="text-primary">using </span>UnityEngine;<br>
    <span class="text-primary">public class </span><span class="text-success">AnimEventListener</span> : <span class="text-success">MonoBehaviour</span><br>
    {<br>
    &emsp;&emsp;<span class="text-primary">void</span> Start() { }<br>
    &emsp;&emsp;<span class="text-primary">void</span> SampleAnimEvent()<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-success">Debug</span>.Log(<span class="text-danger">"Sample Anim Event"</span>);<br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    </div>
    <br>
    
    <p>
    上のコードでわかるように、作成されたアニメーションイベントと同じ名前の関数を呼び出します。<br>
    したがって、アニメーションイベントとスクリプトは同じ名前と同じ引数を持つ必要があります。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_126.jpg"/>
    <br>
    
    <p>
    キャラクターを選択すると、InspectorにapPortraitプロパティが表示されます。<br>
    スクリプトがイベントを受信させるには、作成したスクリプトが含まれている「GameObject」を「<strong>EventListener</strong>」に設定してください。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_128.jpg"/>
    <br>
    
    <p>
    ゲームを実行すると、イベントが発生し、コンソールウィンドウでスクリプトがそれを取得してログを出力することがわかります。<br>
    </p>
    <br>
    
    <br>
    <br>
    <!-- 3. 서브 타이틀 -->
    <h3>アニメーションイベントにパラメータを追加</h3>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_127.jpg"/>
    <br>
    
    <p>
    アニメーションイベントにパラメータを追加できます。<br>
    このとき、パラメータは関数の引数として呼び出されます。<br>
    <strong>(1)</strong> <strong>「Add Parameter」ボタン</strong>を押してパラメータを追加します。<br>
    <strong>(2)</strong> <strong>「Parameter Type」</strong>を選択し、<strong>(3)</strong> で転送する値を入力します。<br>
    (パラメータとして渡すことができる型は 「<span class="text-primary">Bool、Int、Float、Vector2、String</span>」です。)<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    <span class="text-primary">using </span>UnityEngine;<br>
    <span class="text-primary">public class </span><span class="text-success">AnimEventListener</span> : <span class="text-success">MonoBehaviour</span><br>
    {<br>
    &emsp;&emsp;<span class="text-primary">void</span> Start() { }<br>
    &emsp;&emsp;<span class="text-primary">void</span> SampleAnimEvent(<span class="text-primary">float</span> floatValue)<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-success">Debug</span>.Log(<span class="text-danger">"Sample Anim Event - " </span>+ floatValue);<br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    </div>
    <br>
    
    <p>
    パラメータを受け取るように関数を変更します。<br>
    変数型のパラメータを宣言します。<br>
    </p>
    <br>
    
    <p>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_129.jpg"/>
    <br>
    
    <p>
    ゲームを実行すると、パラメータの値が渡されていることがわかります。<br>
    </p>
    <br>
    
    <br>
    <br>
    <!-- 3. 서브 타이틀 -->
    <h3>アニメーションイベントを複数のフレームで連続して呼び出</h3>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_130.jpg"/>
    <br>
    
    <p>
    場合によっては、1つのフレームでイベントを発生させるのではなく、特定のフレームにわたってイベントを連続的に発生させる必要があります。<br>
    <strong>(1)</strong> 「<strong>Call Method</strong>」を「<strong>Once</strong>」から「<span class="text-danger"><strong>Continuous</strong></span>」に変更します。<br>
    <strong>(2)</strong> 「<strong>Start Frame</strong>」と「<strong>End Frame</strong>」をそれぞれ設定します。<br>
    <strong>(3)</strong> 2つのパラメータ値を指定できます。<br>
    各値は、「Start Frame」と「End Frame」によって呼び出されます。 その間に、直線的に補間された値がスクリプトに渡されます。<br>
    (「String」型は補間されないので、この機能はサポートされていません。)<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_131.jpg"/>
    <br>
    
    <p>
    「Continuous」タイプのアニメーションイベントは、異なる色のマーカーで表されます。<br>
    開始点は青で終点は緑です。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_132.jpg"/>
    <br>
    
    <p>
    「Bake」の後にゲームを実行すると、フレームごとに補間された値が呼び出されます。<br>
    </p>
    <br>
    
    <br>
    <br>
    <!-- 3. 서브 타이틀 -->
    <h3>2つ以上のパラメータを持つアニメーションイベントを作成</h3>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_133.jpg"/>
    <br>
    
    <p>
    複数のパラメータを持つアニメーションイベントを作成することもできます。<br>
    各パラメーターは異なるタイプを持つことができます。<br>
    上記の画面は、それぞれ「<strong>Integer、Float、Vector2</strong>」という3つのパラメータを持つ画面です。<br>
    (私は「<strong>MultipleParamAnimEvent</strong>」という名前の新しいアニメーションイベントを作成します。)<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    <span class="text-primary">using </span>UnityEngine;<br>
    <span class="text-primary">public class </span><span class="text-success">AnimEventListener</span> : <span class="text-success">MonoBehaviour</span><br>
    {<br>
    &emsp;&emsp;<span class="text-primary">void </span>Start() { }<br>
    &emsp;&emsp;<span class="text-primary">void </span>MultipleParamAnimEvent(<span class="text-primary">object</span>&#91;&#93; multipleParams)<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-primary">int </span>intParam = (<span class="text-primary">int</span>)multipleParams&#91;0&#93;;<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-primary">float </span>floatParam = (<span class="text-primary">float</span>)multipleParams&#91;1&#93;;<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-success">Vector2 </span>vector2Param = (<span class="text-success">Vector2</span>)multipleParams&#91;2&#93;;<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-success">Debug</span>.Log(<span class="text-danger">"Multiple Param Anim Event"</span>);<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-success">Debug</span>.Log(<span class="text-danger">"Param 1 : "</span> + intParam);<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-success">Debug</span>.Log(<span class="text-danger">"Param 2 : "</span> + floatParam);<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-success">Debug</span>.Log(<span class="text-danger">"Param 3 : "</span> + vector2Param);<br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    </div>
    <br>
    
    <p>
    「<strong>Object Array</strong>」タイプの1つの引数だけが、3つの引数ではなく、関数パラメータとして使用されます。<br>
    この配列には、エディタで定義した順序でパラメータが格納されます。<br>
    変数は型キャストによって参照できます。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_134.jpg"/>
    <br>
    
    <p>
    ゲームを実行すると、3つのパラメータがスクリプトに渡されることがわかります。<br>
    </p>
    <br>
    
    <br>
    <br>
    <!-- 3. 서브 타이틀 -->
    <h3>改善されたインスペクタでのアニメーションイベント</h3>
    <br>
    
    <!-- 4. 버전 설명 -->
    <h4><span class="badge badge-secondary">1.3.4</span></h4>
    
    <p>
    AnyPortrait v1.3.4で、更新されたインスペクター（<a href="../../jp/AdvancedManual/AD_InspectorUI.html">関連ページ</a>）を通って、アニメーションイベントをすばやく確認することができます。<br>
    また、アニメーションイベントをスクリプトにコピーするか、呼び出し方式を変えることが可能です。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1324.jpg"/>
    <br>
    
    <p>
    アニメーションイベントを持ったキャラクターをUnityシーンから選択すれば、上記のような画面がインスペクタに表示されます。<br>
    <strong>(1)</strong> アニメの呼び出し方式を「<strong>Send Message</strong>」と「<strong>Callback</strong>」の中から選択することができます。従来の方式では、「<strong>Send Message</strong>」です。<br>
    <strong>(2)</strong> アニメのイベントを受信して処理する「リスナー（Listener）」オブジェクトです。（既存のInspector上に存在していた、このトピックの位置が変わりました。）<br>
    <strong>(3)</strong> アニメイベントです。イベントの名前とパラメータを確認することができます。<br>
    <strong>(4)</strong> アニメイベントを「クリップボード」にコピーします。コピーされたフォームは、C#スクリプトで貼り付けることができるよう加工されます。<br>
    <strong>(5)</strong> すべてのアニメーションイベントをクリップボードにコピーします。<br>
    </p>
    <br>
    
    <p>
    ここで追加された機能である「クリップボードにアニメーションイベントをコピーする」機能を使ってみましょう。<br>
    まず、<strong>(4)</strong>または<strong>(5)</strong>のコピーボタンを押します。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1325.jpg"/>
    <br>
    
    <p>
    スクリプトエディタを開いて貼り付けをすると、上記のよう、アニメーションイベントの名前、種類に合ったコードが追加されます。<br>
    今、アニメーションイベントを覚えて作成する余計な手間を避けることができます。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1326.jpg"/>
    <br>
    
    <p>
    v1.3.4で追加されたもう一つの特徴は、「<strong>Callback</strong>」方式です。<br>
    既存の「<strong>Send Message</strong>」が「<strong>Unity Send Message</strong>」を利用したものであれば、これは、関数を直接指定する「<strong>Unity Event</strong>」と同様の方法です。<br>
    性能の向上はもちろんのこと、イベントを受信する関数の名前を同じに設定する必要がない利点があります。<br>
    （実際には「Unity Event」を使用しなかったが、私たちは、ユーザーが「Unity Event」のように使用できるように、ほぼ同様に開発しました。）<br>
    <strong>(1)</strong> 「<strong>Event Method</strong>」を「<strong>Callback</strong>」に変更してみましょう。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1327.jpg"/>
    <br>
    
    <p>
    既存の「<strong>Event Listener</strong>」がなくなり、各イベントの呼び出しのターゲットを指定することができるようUIが変更されます。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1328.jpg"/>
    <br>
    
    <p>
    <strong>(1)</strong> <strong>+</strong>ボタンを押します。<br>
    <strong>(2)</strong> イベントリスナーとコールバック関数を設定できる項目が追加されます。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1329.jpg"/>
    <br>
    
    <p>
    <strong>(1)</strong> シーンでイベントを受け取る「Monobehaviour」オブジェクトを割り当てます。<br>
    <strong>(2)</strong> 右側の空白をクリックすると、イベントを受け取ることができる関数の一覧が表示されます。適切な関数を選択します。<br>
    もし1つの「GameObject」に二つ以上の「Monobehaviour」コンポーネントが追加されている場合は、関数の一覧を通しリスナーを交換することができます。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1330.jpg"/>
    <br>
    
    <p>
    <strong>(1)</strong> 同じように、1つのイベントを同時に複数のリスナーで受け取るか、または複数の関数で受けることができるように設定することができます。<br>
    <strong>(2)</strong> 項目を削除したい場合は、<strong>-</strong>ボタンを押します。<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1331.jpg"/>
    <br>
    
    <p>
    コールバック関数を指定するときは、イベントの種類（パラメータの数、種類、順番）に合った関数がない場合は、上記のようにリストには何も出ません。<br>
    </p>
    <br>
    
    <p>
    どのような方法を使用しても、あなたのスクリプトが、アニメーションイベントを受けて動作するようにすることができます。<br>
    自分に合った方法を使用してみてください！<br>
    </p>
    <br>
    
    <!-- 5. 바닥 네비바 -->
    <br>
    <br>
    <br>
    <br>
    <nav class="navbar fixed-bottom navbar-light bg-light">
        <a class="btn btn-light" role="button" href="../../jp/AdvancedManual/AD_ExportImportAnimation.html">< アニメーションをエクスポート/インポート</a>
        <a class="btn btn-light" role="button" href="../../jp/AdvancedManual/AD_CopyBonePose.html">骨のポーズをコピー/貼り付け ></a>
    </nav>
    
    <!-- 페이지 내용 끝! -->

    
    <!-- 종료 -->
    </div>

    <!-- 부트스트랩 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/bootstrap.js"></script>
    <!--------------->

    </body>
</html>
