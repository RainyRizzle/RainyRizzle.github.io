<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <!-- 제목 -->
        <title>캐릭터에 아이템 장착하기</title>
        <!-- 파비콘 -->
        <link rel="shortcut icon" href="../../Images/favicon.ico"/>
        <!-- 부트스트랩 -->
        <link rel="stylesheet" href="../../css/bootstrap.css">
        <!--------------->

    </head>

    <body>
        <p>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <!--로고 : AnyPortrait 홈페이지로 가야한다. (언어별)-->
            <a class="navbar-brand" href="https://www.rainyrizzle.com/anyportrait-kor">
                <img src="../../Images/AP_Logo.png" width="150" height="30" class="d-inline-block align-top" alt="">
            </a>

            <!--메뉴들 : 현재 페이지의 카테고리에 active 붙인다. (언어별 링크) -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="../../kr/GettingStarted.html">시작하기</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="../../kr/AdManual.html">메뉴얼</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../kr/Script.html">스크립트</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://www.rainyrizzle.com/ap-videotutorial-kor">동영상</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://www.rainyrizzle.com/ap-forum">게시판</a>
                </li>

                </ul>

                <!-- 언어 변경. 현재 페이지의 주소에서 언어 주소만 변경한다. (해당 언어에 active) -->
                <div class="btn-group mr-2" role="group" aria-label="Basic example">
                    <a role="button" class="btn btn-secondary" href="../../en/AdvancedManual/AD_AttachEquipments.html">EN</a>
                    <a role="button" class="btn btn-secondary active" href="../../kr/AdvancedManual/AD_AttachEquipments.html">KR</a>
                    <a role="button" class="btn btn-secondary" href="../../jp/AdvancedManual/AD_AttachEquipments.html">JP</a>
                </div>

                <!-- 여백 -->
                <p></p>

                <!-- 검색버튼 -->
                <form class="form-inline">
                    <a class="btn btn-light" role="button" href="../../kr/Search.html">검색</a>
                </form>
            </div>
        </nav>
    </p>

    <!-- 실제 바디 부분 -->
    <div class="container">
    <br>
    <br>
    <!-- 여기에 내용을 적어주세요 -->

    <!-- 여기서부터 페이지 내용이 작성됩니다. -->
    <!-- 1. 페이지 진입 경로 -->
    <p><a href="https://www.rainyrizzle.com/anyportrait-kor"><span class="text-dark">AnyPortrait</span></a> > <a href="../../kr/AdManual.html"><span class="text-dark">메뉴얼</span></a> > 캐릭터에 아이템 장착하기</p>
    
    <!-- 2. 페이지 메인 타이틀 -->
    <h1 class="display-5">캐릭터에 아이템 장착하기</h1>
    <br>
    
    <!-- 4. 버전 설명 -->
    <h4><span class="badge badge-secondary">1.3.2</span></h4>
    
    <p>
    AnyPortrait로 작성된 캐릭터에 외부의 오브젝트를 부착하기 위해서 <strong>소켓</strong>(<a href="../../kr/AdvancedManual/AD_Socket.html">관련 페이지</a>)이라는 기능이 있습니다.<br>
    이 페이지에서는 이 기능을 이용하여 외부의 오브젝트, 특히 무기나 장비와 같은 아이템을 부착하는 방법을 설명합니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1242.jpg"/>
    <br>
    
    <p>
    설명을 위해 제작된 데모 씬의 <strong>해적 소녀 캐릭터</strong>와 <strong>3D 모델로서 제작된 총</strong>입니다.<br>
    현재 캐릭터가 들고 있는 총을 삭제하고, 3D 총을 캐릭터가 오른손으로 잡도록 만들어봅시다.<br>
    </p>
    <br>
    
    <p>
    <span class="text-danger"><strong>주의</strong></span><br>
    이 페이지에서는 차이점을 보여주기 위해 3D 모델을 준비했지만, 2D 이미지가 적용되는 Quad 메시나 Sprite를 준비하는 것이 좋습니다.<br>
    아래에서 설명할 렌더링 방식과 관련된 문제가 있기 때문입니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1243.jpg"/>
    <br>
    
    <p>
    가장 먼저 해야하는 작업은 <strong>소켓</strong>을 설정하는 것입니다.<br>
    <strong>(1)</strong> 무기가 부착될 오른손의 본을 선택합니다.<br>
    <strong>(2)</strong> 스크립트로 해당 본을 호출해야하므로, 본의 <strong>이름</strong>을 기억합니다.<br>
    <strong>(3)</strong> <strong>Socket</strong> 속성을 활성화합니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1244.jpg"/>
    <br>
    
    <p>
    기존의 총 메시는 숨기겠습니다.<br>
    (이 과정은 예제를 만들기 위한 단계이며 무시해도 됩니다.)<br>
    <strong>(1)</strong> 메시 그룹의 <strong>Setting 탭</strong>에서 <strong>(2)</strong> 총 메시를 선택하고 <strong>(3)</strong> <strong>Visible</strong>을 끕니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1245.jpg"/>
    <br>
    
    <p>
    이제 장착할 무기를 준비합니다.<br>
    3D 메시를 비어있는 GameObject의 자식으로 설정하여 무기를 구성했습니다.<br>
    이렇게 준비하는 이유는, 오브젝트의 원점이 <strong>총의 손잡이</strong>여야 하기 때문입니다.<br>
    또한 본이 가리키는 방향은 Y축이므로, 총구도 Y 방향을 향하도록 만듭니다.<br>
    </p>
    <br>
    
    <p>
    이제 스크립트를 아래와 같이 작성해봅시다.<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    using UnityEngine;<br>
    using AnyPortrait;<br>
    <br>
    public class WeaponEquipScript : MonoBehaviour<br>
    {<br>
    &emsp;&emsp;public apPortrait portrait;<br>
    &emsp;&emsp;public Transform gunTransform;&emsp;&emsp;<br>
    <br>
    &emsp;&emsp;void Start()<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;//캐릭터의 오른손 본을 무기의 부모로서 설정<br>
    &emsp;&emsp;&emsp;&emsp;<strong>Transform handBone = portrait.GetBoneSocket("Bone Hand R");</strong><br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.parent = handBone;<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;//위치와 회전을 소켓과 동일하게 만들고, 크기는 부호만 확인<br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.localPosition = Vector3.zero;<br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.localRotation = Quaternion.identity;<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;Vector3 gunScale = gunTransform.localScale;<br>
    &emsp;&emsp;&emsp;&emsp;if(gunScale.x < 0) { gunScale.x *= -1; }<br>
    &emsp;&emsp;&emsp;&emsp;if(gunScale.y < 0) { gunScale.y *= -1; }<br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.localScale = gunScale;<br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    <button id="scriptcopybutton0" class="btn btn-info float-right">클립보드로 복사</button>
    <br><br>
    
    </div>
    <br>
    
    <p>
    <strong>GetBoneSocket</strong> 함수를 이용하여 오른손 본의 Transform을 가져올 수 있습니다.<br>
    무기의 GameObject를 오른손 본의 Transform의 자식이 되도록 변경하고 로컬 위치를 초기화하면, 무기 메시가 오른손의 움직임에 따라 움직일 것입니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1246.jpg"/>
    <br>
    
    <p>
    위 스크립트를 씬에 적용합니다.<br>
    <strong>(1)</strong> 새로운 <strong>GameObject</strong>를 만듭니다.<br>
    <strong>(2)</strong> 작성한 스크립트를 추가된 GameObject에 추가하고, 캐릭터와 무기의 Transform을 각각 지정합니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1247.jpg"/>
    <br>
    
    <p>
    게임을 실행해봅시다.<br>
    총이 캐릭터의 오른손에 부착되어 움직이는 것을 볼 수 있습니다.<br>
    총의 렌더링 순서가 이상합니다.<br>
    총이 캐릭터의 손 안에 들어가야 하는데, 지금은 캐릭터의 뒤쪽에 위치합니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1248.jpg"/>
    <br>
    
    <p>
    총의 렌더링 순서를 지정하기 위해서는 메시의 렌더링 순서, 즉 <strong>Sorting Order</strong>를 알아야 합니다.<br>
    AnyPortrait 에디터를 다시 엽니다.<br>
    <strong>(1)</strong> 이 캐릭터의 오른손은 <strong>손바닥</strong> 메시와 <strong>손가락</strong> 메시로 나뉘어져 있으며, 총이 그 사이에 위치합니다.<br>
    <strong>(2)</strong> <strong>오른손의 손가락 메시</strong>를 선택하고 <strong>(3)</strong> 메시의 <strong>이름</strong> (Hand R Finger)를 기억합니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1249.jpg"/>
    <br>
    
    <p>
    메시들의 렌더링 순서에 따라 서로 다른 <strong>Sorting Order</strong>가 할당되도록 만듭니다.<br>
    <strong>(1)</strong> <strong>Bake</strong> 버튼을 누릅니다.<br>
    <strong>(2)</strong> <strong>Setting 탭</strong>을 누릅니다.<br>
    <strong>(3)</strong> <strong>Sorting Order Option</strong>을 <strong>Depth To Order</strong>로 변경하고, <strong>Order Per Depth</strong>를 <strong>2</strong>로 증가시킵니다.<br>
    스크립트로 총 메시의 Sorting Order를 <strong>오른손 손가락 메시</strong>보다 1 적게 만들고자 하므로, Sorting Order는 2 이상의 간격으로 할당되어야 다른 메시와 렌더링 순서가 중복되는 것을 피할 수 있습니다.<br>
    </p>
    <br>
    
    <p>
    스크립트를 아래와 같이 수정하여 Sorting Order를 제어합니다.<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    using UnityEngine;<br>
    using AnyPortrait;<br>
    <br>
    public class WeaponEquipScript : MonoBehaviour<br>
    {<br>
    &emsp;&emsp;public apPortrait portrait;<br>
    &emsp;&emsp;public Transform gunTransform;<br>
    &emsp;&emsp;<span class="text-danger"><strong>public MeshRenderer gunMeshRenderer;</strong></span><br>
    <br>
    &emsp;&emsp;void Start()<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;//캐릭터의 오른손 본을 무기의 부모로서 설정<br>
    &emsp;&emsp;&emsp;&emsp;Transform handBone = portrait.GetBoneSocket("Bone Hand R");<br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.parent = handBone;<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;//위치와 회전을 소켓과 동일하게 만들고, 크기는 부호만 확인<br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.localPosition = Vector3.zero;<br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.localRotation = Quaternion.identity;<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;Vector3 gunScale = gunTransform.localScale;<br>
    &emsp;&emsp;&emsp;&emsp;if(gunScale.x < 0) { gunScale.x *= -1; }<br>
    &emsp;&emsp;&emsp;&emsp;if(gunScale.y < 0) { gunScale.y *= -1; }<br>
    &emsp;&emsp;&emsp;&emsp;gunTransform.localScale = gunScale;<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;//손가락 메시의 바로 뒤에서 렌더링 되도록 설정<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-danger"><strong>int fingerSortingOrder = portrait.GetSortingOrder("Hand R Finger");</strong></span><br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-danger"><strong>gunMeshRenderer.sortingOrder = fingerSortingOrder - 1;</strong></span><br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    <button id="scriptcopybutton1" class="btn btn-info float-right">클립보드로 복사</button>
    <br><br>
    
    </div>
    <br>
    
    <p>
    총 모델의 MeshRenderer의 <strong>Sorting Order</strong>를 캐릭터의 <strong>오른손 손가락 메시(Hand R Finger)</strong>보다 1 작게 설정하는 스크립트입니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1250.jpg"/>
    <br>
    
    <p>
    스크립트에 <strong>MeshRenderer gunMeshRenderer</strong> 변수가 추가되었으므로, 유니티 에디터에서 총 메시의 MeshRenderer를 할당합니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1251.jpg"/>
    <br>
    
    <p>
    여기서 주의할 점이 있습니다.<br>
    기본적으로 부피를 가진 Opaque 방식의 재질은 Sorting Order로 렌더링 순서를 제어할 수 없습니다.<br>
    따라서 이 예제에서 3D 모델로 제작된 총의 렌더링 방식을 <strong>Transparent</strong>로 변경해야합니다.<br>
    <strong>Transparent</strong> 방식의 재질에서 이 모델의 렌더링은 다소 이상할 수 있습니다.<br>
    따라서 가능한 2D 이미지를 그대로 이용하는 Quad 메시나 Sprite로 아이템을 만들기를 권장합니다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_1252.jpg"/>
    <br>
    
    <p>
    게임을 실행하면 렌더링 순서가 보정되어 캐릭터가 제대로 총을 쥐는 것이 표현됩니다.<br>
    </p>
    <br>
    
    <!-- 5. 바닥 네비바 -->
    <br>
    <br>
    <br>
    <br>
    <nav class="navbar fixed-bottom navbar-light bg-light">
        <a class="btn btn-light" role="button" href="../../kr/AdvancedManual/AD_ImprovePerformance.html">< 성능 향상시키기</a>
        <a class="btn btn-light" role="button" href="../../kr/AdvancedManual/AD_WindEffect.html">바람 효과 구현하기 ></a>
    </nav>
    
    <!-- 페이지 내용 끝! -->

    
    <!-- 종료 -->
    </div>

    <!-- 부트스트랩 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/bootstrap.js"></script>
    <!--------------->

    <!-- 클립보드 스크립트 -->
    <script>
    document.getElementById("scriptcopybutton0").addEventListener("click", function() {
    const textToCopy = "using UnityEngine;\nusing AnyPortrait;\n\npublic class WeaponEquipScript : MonoBehaviour\n{\n\tpublic apPortrait portrait;\n\tpublic Transform gunTransform;\t\n\n\tvoid Start()\n\t{\n\t\t//캐릭터의 오른손 본을 무기의 부모로서 설정\n\t\tTransform handBone = portrait.GetBoneSocket(\"Bone Hand R\");\n\t\tgunTransform.parent = handBone;\n\n\t\t//위치와 회전을 소켓과 동일하게 만들고, 크기는 부호만 확인\n\t\tgunTransform.localPosition = Vector3.zero;\n\t\tgunTransform.localRotation = Quaternion.identity;\n\n\t\tVector3 gunScale = gunTransform.localScale;\n\t\tif(gunScale.x < 0) { gunScale.x *= -1; }\n\t\tif(gunScale.y < 0) { gunScale.y *= -1; }\n\t\tgunTransform.localScale = gunScale;\n\t}\n}\n";
    navigator.clipboard.writeText(textToCopy).then(() => {
        alert("스크립트가 클립보드에 복사되었습니다.");
    }).catch(err => {
        console.error("클립보드 복사 실패:", err);
    });
    });
    </script>
    
    <script>
    document.getElementById("scriptcopybutton1").addEventListener("click", function() {
    const textToCopy = "using UnityEngine;\nusing AnyPortrait;\n\npublic class WeaponEquipScript : MonoBehaviour\n{\n\tpublic apPortrait portrait;\n\tpublic Transform gunTransform;\n\tpublic MeshRenderer gunMeshRenderer;\n\n\tvoid Start()\n\t{\n\t\t//캐릭터의 오른손 본을 무기의 부모로서 설정\n\t\tTransform handBone = portrait.GetBoneSocket(\"Bone Hand R\");\n\t\tgunTransform.parent = handBone;\n\n\t\t//위치와 회전을 소켓과 동일하게 만들고, 크기는 부호만 확인\n\t\tgunTransform.localPosition = Vector3.zero;\n\t\tgunTransform.localRotation = Quaternion.identity;\n\n\t\tVector3 gunScale = gunTransform.localScale;\n\t\tif(gunScale.x < 0) { gunScale.x *= -1; }\n\t\tif(gunScale.y < 0) { gunScale.y *= -1; }\n\t\tgunTransform.localScale = gunScale;\n\n\t\t//손가락 메시의 바로 뒤에서 렌더링 되도록 설정\n\t\tint fingerSortingOrder = portrait.GetSortingOrder(\"Hand R Finger\");\n\t\tgunMeshRenderer.sortingOrder = fingerSortingOrder - 1;\n\t}\n}\n";
    navigator.clipboard.writeText(textToCopy).then(() => {
        alert("스크립트가 클립보드에 복사되었습니다.");
    }).catch(err => {
        console.error("클립보드 복사 실패:", err);
    });
    });
    </script>
    

    <!--------------->

    </body>
</html>
