<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <!-- 제목 -->
        <title>스크립트로 초기화하기</title>
        <!-- 파비콘 -->
        <link rel="shortcut icon" href="../../Images/favicon.ico"/>
        <!-- 부트스트랩 -->
        <link rel="stylesheet" href="../../css/bootstrap.css">
        <!--------------->

    </head>

    <body>
        <p>
            <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <!--로고 : AnyPortrait 홈페이지로 가야한다. (언어별)-->
            <a class="navbar-brand" href="https://www.rainyrizzle.com/anyportrait-kor">
                <img src="../../Images/AP_Logo.png" width="150" height="30" class="d-inline-block align-top" alt="">
            </a>

            <!--메뉴들 : 현재 페이지의 카테고리에 active 붙인다. (언어별 링크) -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarText">
                <ul class="navbar-nav mr-auto">
                <li class="nav-item">
                    <a class="nav-link" href="../../kr/GettingStarted.html">시작하기</a>
                </li>
                <li class="nav-item active">
                    <a class="nav-link" href="../../kr/AdManual.html">메뉴얼</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../../kr/Script.html">스크립트</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://www.rainyrizzle.com/ap-videotutorial-kor">동영상</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="https://www.rainyrizzle.com/ap-forum">게시판</a>
                </li>

                </ul>

                <!-- 언어 변경. 현재 페이지의 주소에서 언어 주소만 변경한다. (해당 언어에 active) -->
                <div class="btn-group mr-2" role="group" aria-label="Basic example">
                    <a role="button" class="btn btn-secondary" href="../../en/AdvancedManual/AD_InitializeScript.html">EN</a>
                    <a role="button" class="btn btn-secondary active" href="../../kr/AdvancedManual/AD_InitializeScript.html">KR</a>
                    <a role="button" class="btn btn-secondary" href="../../jp/AdvancedManual/AD_InitializeScript.html">JP</a>
                </div>

                <!-- 여백 -->
                <p></p>

                <!-- 검색버튼 -->
                <form class="form-inline">
                    <a class="btn btn-light" role="button" href="../../kr/Search.html">검색</a>
                </form>
            </div>
        </nav>
    </p>

    <!-- 실제 바디 부분 -->
    <div class="container">
    <br>
    <br>
    <!-- 여기에 내용을 적어주세요 -->

    <!-- 여기서부터 페이지 내용이 작성됩니다. -->
    <!-- 1. 페이지 진입 경로 -->
    <p><a href="https://www.rainyrizzle.com/anyportrait-kor"><span class="text-dark">AnyPortrait</span></a> > <a href="../../kr/AdManual.html"><span class="text-dark">메뉴얼</span></a> > 스크립트로 초기화하기</p>
    
    <!-- 2. 페이지 메인 타이틀 -->
    <h1 class="display-5">스크립트로 초기화하기</h1>
    <br>
    
    <!-- 4. 버전 설명 -->
    <h4><span class="badge badge-secondary">1.1.7</span></h4>
    
    <p>
    유니티의 기본적인 함수인 "<strong>Instantiate</strong>"를 이용하여 프리팹의 오브젝트를 씬에 배치하거나, 씬의 오브젝트를 복제할 수 있습니다.<br>
    <strong>Instantiate</strong>는 유니티로 게임을 만들 때 가장 많이 사용되는 함수 중 하나일 것입니다.<br>
    AnyPortrait로 제작한 캐릭터를 <strong>Instantiate </strong>함수로 복제할 때, 간혹 초기화에 대한 에러를 겪는 경우가 있습니다.<br>
    이 페이지는 간단한 코드 예제를 통해서 초기화에 대해서 설명합니다.<br>
    (초기화 함수에 관해서는 <a href="../../kr/Script/SC_Init.html">관련 페이지</a>를 참고해주세요.)<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_615.jpg"/>
    <br>
    
    <p>
    씬에 배치된 AnyPortrait 캐릭터를 복제해봅시다.<br>
    이 샘플은 "Space Bar"를 입력하면 캐릭터가 복제되어서 약간 오른쪽에 배치되고 "Move" 애니메이션을 재생해보겠습니다.<br>
    이것으로 스크립트로 작성하면 다음과 같을 것입니다.<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    <span class="text-primary">public class </span><span class="text-success">InitializeSample </span>: <span class="text-success">MonoBehaviour</span><br>
    {<br>
    &emsp;&emsp;// 대상이 되는 apPortrait<br>
    &emsp;&emsp;<span class="text-primary"><strong>public </strong></span><span class="text-success">apPortrait </span>portrait;<br>
    <br>
    &emsp;&emsp;<span class="text-primary">void </span>Start () { }<br>
    <br>
    &emsp;&emsp;<span class="text-primary">void </span>Update ()<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-primary">if </span>( <span class="text-success">Input</span>.GetKeyDown(<span class="text-success">KeyCode</span>.Space) )<br>
    &emsp;&emsp;&emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;// GameObject를 Instantiate로 복사하기<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-success">GameObject </span>newGameObject = <strong>Instantiate</strong>&lt;<span class="text-success">GameObject</span>&gt;(<strong>portrait</strong>.gameObject);<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;// 위치 이동<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;newGameObject.transform.position = <span class="text-primary">new </span><span class="text-success">Vector3</span>(8, 0, 0);<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;// 복제된 GameObject에서 apPortrait 컴포넌트 얻기<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-success">apPortrait </span><strong>newPortrait </strong>= newGameObject.GetComponent&lt;<span class="text-success">apPortrait</span>&gt;();<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;//&nbsp;&nbsp;Move 애니메이션 <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;newPortrait.<strong>Play</strong>(<span class="text-danger">"Move"</span>);<br>
    &emsp;&emsp;&emsp;&emsp;}<br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    </div>
    <br>
    
    <p>
    이 스크립트를 유니티 씬에 배치하고 게임을 실행해봅시다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_616.jpg"/>
    <br>
    
    <p>
    게임을 실행하고 Space Bar를 누르면 캐릭터가 복제가 되지만 <strong>에러</strong>가 발생합니다.<br>
    그리고 "<strong>Move</strong>" 애니메이션도 재생되지 않습니다.<br>
    이 에러는 유니티 씬에 처음으로 배치된 캐릭터가 <strong>초기화 과정</strong>을 거치지 않은 상태에서, 바로 Play 함수가 호출되었기 때문입니다.<br>
    </p>
    <br>
    
    <p>
    AnyPortrait의 시스템은, 자동으로 캐릭터가 처음 로드되면 해당 업데이트 프레임에 바로 <strong>초기화</strong>를 수행합니다.<br>
    그렇지만 Instantiate 함수로 로드된 직후에 apPortrait의 어떤 함수를 호출한다면, 아직 초기화가 되지 않은 상태이므로 에러가 발생하며 그 함수는 정상적으로 동작하지 않습니다.<br>
    </p>
    <br>
    
    <p>
    이 문제를 해결하는 방법은 다음의 두가지가 있습니다.<br>
    <strong>(1)</strong> <strong>스크립트</strong>를 이용하여 <strong>초기화</strong>를 직접 실행합니다.<br>
    <strong>(2)</strong> 로드된 프레임에서는 apPortrait의 함수를 호출하지 않고, <strong>다음 프레임</strong>까지 기다립니다.<br>
    </p>
    <br>
    
    <p>
    이 페이지에서는 <strong>(1)</strong>의 방법에 대해서 설명합니다.<br>
    </p>
    <br>
    
    <p>
    코드를 다음과 같이 수정해봅시다.<br>
    (불필요한 주석은 삭제했습니다.)<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    <span class="text-primary">public class </span><span class="text-success">InitializeSample </span>: <span class="text-success">MonoBehaviour</span><br>
    {<br>
    &emsp;&emsp;<span class="text-primary"><strong>public </strong></span><span class="text-success">apPortrait </span>portrait;<br>
    <br>
    &emsp;&emsp;<span class="text-primary">void </span>Start () { }<br>
    <br>
    &emsp;&emsp;<span class="text-primary">void </span>Update ()<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-primary">if </span>( <span class="text-success">Input</span>.GetKeyDown(<span class="text-success">KeyCode</span>.Space) )<br>
    &emsp;&emsp;&emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-success">GameObject </span>newGameObject = <strong>Instantiate</strong>&lt;<span class="text-success">GameObject</span>&gt;(<strong>portrait</strong>.gameObject);<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;newGameObject.transform.position = <span class="text-primary">new </span><span class="text-success">Vector3</span>(8, 0, 0);<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-success">apPortrait </span><strong>newPortrait </strong>= newGameObject.GetComponent&lt;<span class="text-success">apPortrait</span>&gt;();<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;// 바로 초기화를 하기 위해 Initialize 함수 호출 후 Move 애니메이션 재생<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-danger">newPortrait.</span><span class="text-danger"><strong>Initialize</strong></span>(); <br>
    <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;newPortrait.<strong>Play</strong>(<span class="text-danger">"Move"</span>);<br>
    &emsp;&emsp;&emsp;&emsp;}<br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    </div>
    <br>
    
    <p>
    Play 함수를 실행하기 전에 apPortrait의 <span class="text-danger"><strong>Initialize</strong></span> 함수를 호출하도록 작성했습니다.<br>
    Initialize 함수는 apPortrait를 초기화하여 업데이트를 할 수 있도록 준비시키는 역할을 합니다.<br>
    </p>
    <br>
    
    <p>
    이제 게임을 실행해봅시다.<br>
    </p>
    <br>
    
    <!-- 8. 이미지 (가운데 정렬) -->
    <br>
    <img class="img-fluid rounded-sm mx-auto d-block" style="max-width:80%;" src="../../Images/Advanced/AdManual_617.jpg"/>
    <br>
    
    <p>
    슬라임 캐릭터가 복제되어 에러 없이 Move 애니메이션이 재생이 됩니다.<br>
    </p>
    <br>
    
    <p>
    초기화 함수는 Initialize 외에도 AsyncInitialize 함수도 있습니다.<br>
    이 함수들의 특징은 다음과 같습니다.<br>
    </p>
    <br>
    
    <p>
    <strong>1. Initialize()</strong><br>
    : 기본적인 초기화 함수입니다.<br>
    함수가 호출되는 시점에서 모든 초기화 처리가 이루어집니다.<br>
    함수가 호출될 때 초기화가 완료되므로 바로 apPortrait를 제어할 수 있는 장점이 있습니다.<br>
    캐릭터가 애니메이션이나 모디파이어를 많이 가지고 있다면 초기화 코드는 매우 무거우며, 일시적으로 FPS (Frames Per Second)가 저하될 수 있습니다.<br>
    </p>
    <br>
    
    <p>
    <strong>2. AsyncInitialize(OnAsyncLinkCompleted onAsyncLinkCompleted)</strong><br>
    : 비동기 초기화 함수입니다.<br>
    게임 중에 초기화가 될 때 FPS가 크게 떨어지는 것이 문제가 된다면, 이 함수는 좋은 선택이 될 것입니다.<br>
    함수가 호출되더라도 초기화는 약간의 업데이트가 진행된 이후에 완료됩니다.<br>
    이 함수가 호출된 직후에는 apPortrait를 바로 제어할 수 없습니다.<br>
    초기화가 완료될 때 인자로 입력된 이벤트를 호출합니다.<br>
    </p>
    <br>
    
    <p>
    <strong>3. AsyncInitialize(int timePerYield, OnAsyncLinkCompleted onAsyncLinkCompleted)</strong><br>
    : v1.1.7에서 추가된 함수입니다.<br>
    ms 단위의 timePerYield 인자가 추가되어 비동기 처리 단위의 제한 시간을 지정할 수 있습니다.<br>
    기존의 AsyncInitialize 함수에 비해서 처리 시간은 더 증가되지만, 게임의 FPS를 인식하여 최대한 성능에 영향을 주지 않도록 개선되었습니다.<br>
    동시에 많은 캐릭터를 로드할 때 좋습니다.<br>
    </p>
    <br>
    
    <p>
    비동기 초기화를 이용하여 코드를 작성해봅시다.<br>
    </p>
    <br>
    
    <!-- 23. 코드 예시 -->
    <div class="alert alert-warning" role="alert">
    <p>
    <br>
    <span class="text-primary">public class </span><span class="text-success">InitializeSample </span>: <span class="text-success">MonoBehaviour</span><br>
    {<br>
    &emsp;&emsp;<span class="text-primary"><strong>public </strong></span><span class="text-success">apPortrait </span>portrait;<br>
    <br>
    &emsp;&emsp;<span class="text-primary">void </span>Start () { }<br>
    <br>
    &emsp;&emsp;<span class="text-primary">void </span>Update ()<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;<span class="text-primary">if </span>( <span class="text-success">Input</span>.GetKeyDown(<span class="text-success">KeyCode</span>.Space) )<br>
    &emsp;&emsp;&emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-success">GameObject </span>newGameObject = <strong>Instantiate</strong>&lt;<span class="text-success">GameObject</span>&gt;(<strong>portrait</strong>.gameObject);<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;newGameObject.transform.position = <span class="text-primary">new </span><span class="text-success">Vector3</span>(8, 0, 0);<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-success">apPortrait </span><strong>newPortrait </strong>= newGameObject.GetComponent&lt;<span class="text-success">apPortrait</span>&gt;();<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;// 비동기 초기화 함수 호출<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;<span class="text-danger">newPortrait.</span><span class="text-danger"><strong>AsyncInitialize</strong></span>(<strong>OnAsyncPortraitIntialized</strong>);<br>
    <br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;// 또는 이렇게 작성해도 됩니다.<br>
    &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;// newPortrait.AsyncInitialize(100, OnAsyncPortraitIntialized);<br>
    &emsp;&emsp;&emsp;&emsp;}<br>
    &emsp;&emsp;}<br>
    <br>
    &emsp;&emsp;// 초기화가 완료되면 호출되는 이벤트<br>
    &emsp;&emsp;<span class="text-primary">void </span><strong>OnAsyncPortraitIntialized</strong>(<span class="text-success">apPortrait </span>portrait)<br>
    &emsp;&emsp;{<br>
    &emsp;&emsp;&emsp;&emsp;portrait.<strong>Play</strong>(<span class="text-danger">"Move"</span>);<br>
    &emsp;&emsp;}<br>
    }<br>
    <br>
    </p>
    </div>
    <br>
    
    <p>
    비동기 초기화는 바로 완료되지 않으므로, 초기화 함수 호출 직후에 apPortrait를 제어할 수 없습니다.<br>
    이벤트를 이용하는 것을 권장합니다.<br>
    </p>
    <br>
    
    <!-- 5. 바닥 네비바 -->
    <br>
    <br>
    <br>
    <br>
    <nav class="navbar fixed-bottom navbar-light bg-light">
        <a class="btn btn-light" role="button" href="../../kr/AdvancedManual/AD_CharacterCostume.html">< 캐릭터의 의상을 교체하기</a>
        <a class="btn btn-light" role="button" href="../../kr/AdvancedManual/AD_ReduceDrawCalls.html">드로우콜 줄이기 ></a>
    </nav>
    
    <!-- 페이지 내용 끝! -->

    
    <!-- 종료 -->
    </div>

    <!-- 부트스트랩 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/bootstrap.js"></script>
    <!--------------->

    </body>
</html>
